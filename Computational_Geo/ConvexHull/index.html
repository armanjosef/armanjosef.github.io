<!DOCTYPE html>
<html>
    <head>
        <title>Convex Hull Algorithms</title>
        <script type="text/javascript">
            var Module = {
                onRuntimeInitialized: function() {
                    console.log("Module loaded: ", Module);
                }
            };
        </script>
        <script src="convex.js" type="text/javascript"></script>
    </head>

    <body>
        <div style="width: 500px;float:left;">
            <canvas id="slowConvex" width=500 height=500 style="border:2px dotted"></canvas>
            <button onclick="js_slow()"> Display SlowConvexHull </button>
        </div>
        <div style="width: 500px;float:left;">
            <canvas id="incrementalConvex" width=500 height=500 style="border:2px dotted"></canvas>
            <button onclick="incrementalConvex()"> Display IncrementalConvexHull </button>
        </div>
        <button onclick="fillWithRandomPoints()"> Generate Random Points </button>
        <button onclick="clearCanvas()"> Clear </button>
    </body>
    <script type="text/javascript">
        document.getElementById("slowConvex").addEventListener("click", getPoint);

       // var slowConvexContext = getElementById('slowConvex').getContext('2d');
        //var incrementalContext = getElementById('incrementalConvex').getContext('2d');

        var imageData;

        function clearCanvas() {
            document.getElementById('slowConvex').getContext('2d').clearRect(0, 0, 500, 500);
            document.getElementById('incrementalConvex').getContext('2d').clearRect(0, 0, 500, 500);
            Module.clearPoints();
            i = j = k = 0;
        }

        function fillWithRandomPoints() {
            clearCanvas();
            Module.randomPoints(100, 500);
            imageData = document.getElementById('incrementalConvex').getContext('2d').getImageData(0, 0, 500, 500);
        }

        function getPoint(event) {
            var canvas = document.getElementById('slowConvex');
            var x = event.clientX - canvas.getBoundingClientRect().left - 1.5;
            var y = event.clientY - canvas.getBoundingClientRect().top - 2.5;

			if (canvas.getContext) {
                var context = canvas.getContext('2d');
                context.beginPath();
                context.arc(x, y, 3, 0, Math.PI * 2, true);
                context.fillStyle = "#ff2626";
                context.fill();
            }
            Module.addPoint(x, y);
        }

        var i = 0;
        var j = 0;
        var k = 0;
        var req;

        function js_slow() {
            var tmp = Module.animateSlowConvex(i, j, k);
            i = tmp.get(0);
            j = tmp.get(1);
            k = tmp.get(2);
            if (i < Module.getPoints().size())
                requestAnimationFrame(js_slow);
        }

        function clearLine(sx, sy, ex, ey) {

            var ctx = document.getElementById("incrementalConvex").getContext("2d");
            ctx.beginPath();
            ctx.lineWidth = 2;
            ctx.strokeStyle = "white";

            //ctx.setLineDash([10, 10]);
            ctx.moveTo(sx, sy);
            ctx.lineTo(ex, ey);

            ctx.stroke();

            Module.redrawPoints();
        }

        function incrementalConvex() {
            var ind = 0;
            Module.incrementalConvexHull();
            var interval = setInterval( function () {
                var flag = Module.animateIncrementalConvex();
                ind++;
                if (flag)
                    clearInterval(interval);
            }, 50);
        }

    </script>
</html>