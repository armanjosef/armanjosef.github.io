<!DOCTYPE html>
<html>
    <head>
        <title>Convex Hull Algorithms</title>
        <script type="text/javascript">
            var Module = {
                onRuntimeInitialized: function() {
                    console.log("Module loaded: ", Module);
                }
            };
        </script>
        <script src="convex.js" type="text/javascript"></script>
    </head>

    <body>
        <div style="width: 100%;">
            <canvas id="canvas" width=500 height=500 style="border:2px dotted"></canvas>
        </div>
        <button onclick="js_slow()"> Display SlowConvexHull </button>
        <button onclick="Module.randomPoints(50)"> Generate Random Points </button>
        <button onclick="clearCanvas()"> Clear </button>
    </body>
    <script type="text/javascript">
        document.getElementById("canvas").addEventListener("click", getPoint);

        function clearCanvas() {
            document.getElementById('canvas').getContext('2d').clearRect(0, 0, 500, 500);
            Module.clearPoints();
            i = j = k = 0;
        }

        function getPoint(event) {
            var canvas = document.getElementById('canvas');
            var x = event.clientX - canvas.getBoundingClientRect().left - 1.5;
            var y = event.clientY - canvas.getBoundingClientRect().top - 2.5;

			if (canvas.getContext) {
                var context = canvas.getContext('2d');
                context.beginPath();
                context.arc(x, y, 3, 0, Math.PI * 2, true);
                context.fillStyle = "#ff2626";
                context.fill();
            }
            Module.addPoint(x, y);
        }

        var i = 0;
        var j = 0;
        var k = 0;
        var imageData;
        var req;

        function js_slow() {
            var tmp = Module.animateSlowConvex(i, j, k);
            i = tmp.get(0);
            j = tmp.get(1);
            k = tmp.get(2);
            if (i < Module.getPoints().size())
                requestAnimationFrame(js_slow);
        }
/*
        function js_slow() {
            if (i < Module.getPoints().size()) {
                if (j == i)
                   j++; 
                if (j >= Module.getPoints().size()){
                    j = 0;
                    i++;
                    req = requestAnimationFrame(js_slow);
                    return;
                }

                if (k == 0) {
                    line = false;
                    imageData = document.getElementById('canvas').getContext('2d').getImageData(0, 0, 500, 500);
                    drawLine(Module.getPoints().get(i)['x'],
                             Module.getPoints().get(i)['y'],
                             Module.getPoints().get(j)['x'],
                             Module.getPoints().get(j)['y']);
                    valid = false;
                }
                {
                    drawPoint(Module.getPoints().get(k)['x'], Module.getPoints().get(k)['y']);
                    valid = Module.getDeterminant(i, j, k);
                    k++;
                    if (valid) 
                        document.getElementById('canvas').getContext('2d').putImageData(imageData, 0, 0);
                    if (valid || k >= Module.getPoints().size()) {
                        k = 0;
                        j++;
                        line = true;
                    }
                }
            }
            if (i < Module.getPoints().size())
                req = requestAnimationFrame(js_slow);
        }
*/
    </script>
</html>